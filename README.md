# Mini Six Ren Project

小六壬占卜系统 - 一个基于Python的中国传统占卜和命理分析应用。

## 项目简介

Mini Six Ren（小六壬）是一个集成了多种中国传统文化元素的占卜应用，包含：

- **小六壬占卜** - 基于传统小六壬算法的占卜系统
- **八字测算** - 根据出生时间计算生辰八字并进行命理分析
- **五行分析** - 完整的五行相生相克关系分析
- **历法转换** - 公历农历相互转换
- **笔画计算** - 汉字笔画数计算和分析

## 功能特色

### 🔮 小六壬占卜
- 支持三种输入方式：数字、日期、汉字笔画
- 自动计算三传（初传、中传、末传）
- 五行生克关系分析
- 集成AI智能解读

### 🧮 八字测算
- 精确的公历农历转换
- 完整的生辰八字计算
- 日主强弱分析
- 配偶宫位解读
- 五行缺失影响评估

### 🎨 界面特色

#### CLI版本
- 美观的终端彩色界面
- 渐变色标题和菜单
- 分层式菜单结构
- 丰富的表格展示

#### Web版本
- 🌌 **现代化Bento Grid布局** - 不同大小卡片组合，营造视觉节奏
- 🎨 **高饱和度渐变色彩** - 紫色、青色、琥珀色三色渐变系统
- ✨ **毛玻璃效果** - 背景模糊和透明度效果，现代科技感
- 📝 **超大字号对比** - 突出核心数据，配合精致小字解释
- 🔄 **悬停动画** - 交互元素的上升和阴影效果

## 安装和运行

### 环境要求
- Python 3.13+
- uv 包管理器
- 支持所有平台：Windows、macOS (Intel/ARM64)、Linux

### 安装依赖
```bash
# 使用uv安装依赖
uv sync
```

### 运行应用

#### CLI版本（命令行界面）
```bash
# 启动小六壬占卜系统CLI版
uv run src/cli.py
```

#### Web版本（现代化网页界面）
```bash
# 启动小六壬占卜系统Web版
uv run src/web.py
```
然后在浏览器中访问 `http://localhost:8080`

**Web版本特色**：
- 🌌 现代化深色主题设计，美观易用
- 📱 响应式布局，支持电脑和手机访问
- ✨ 实时AI解读，带格式化的结构化显示
- 📊 三传结果可视化展示，箭头指示五行关系
- 📝 智能表单验证和错误提示
- 🔢 支持更大数字范围（1-999）的占卜输入

## 核心依赖

- `pydantic-ai` - 现代化AI集成框架，支持多LLM提供商
- `lunardate` - 纯Python中国农历库（替代sxtwl以支持ARM64架构）
- `openai` - OpenAI API支持（可选）
- `rich` - 终端UI美化和流式显示
- `python-dotenv` - 环境变量管理
- `nicegui` - Python web界面框架，用于Web版本

### 依赖变更说明

**从sxtwl迁移到lunardate**：
- 原因：sxtwl库在Apple Silicon (ARM64) 架构上编译失败
- 解决方案：使用纯Python的lunardate库替代
- 功能影响：农历转换和八字计算功能完全保留，使用简化算法
- 兼容性：支持所有平台架构，包括ARM64/M1/M2/M3 Mac

## 使用方法

### 1. 小六壬占卜

#### CLI版本使用
启动应用后选择"小六壬占卜"，然后：
1. **选择AI模型**（如有多个可用）- 自动检测可用的OpenAI或DeepSeek模型
2. **选择输入方式**：
   - **数字输入**: 输入三个数字（如：1,2,3）
   - **日期输入**: 输入公历日期和时间
   - **汉字输入**: 输入三个汉字，系统自动计算笔画
3. **实时观看AI解读生成过程**

#### Web版本使用
在浏览器中访问 Web 界面，享受现代化的操作体验：
1. **直观的模型选择** - 下拉菜单展示可用AI模型
2. **多选项卡输入**：
   - 🔢 **数字模式**: 输入三个数字（支持 1-999）
   - 📅 **时间模式**: 选择日期和时间，自动转换
   - 📝 **汉字模式**: 输入汉字，智能计算笔画
3. **结构化问题输入** - 多行文本框支持详细描述
4. **美化的结果展示** - 三传结果卡片化展示，带箭头指示五行关系
5. **结构化AI解读** - 格式化段落、标题、列表显示

### 2. 八字测算
选择"八字测算"，输入：
- 公历出生日期（YYYY-MM-DD）
- 出生时间（HH:MM）
- 性别（M/F）

### 3. 工具功能
- **笔画计算**: 计算汉字笔画数
- **历法转换**: 公历农历相互转换
- **五行信息**: 查看详细的五行知识
- **日主分析**: 分析特定日期的五行属性

## 配置说明

### AI功能配置（可选）
如需使用AI智能解读功能，请：
1. 创建`.env`文件
2. 添加至少一个AI模型的API密钥：
   ```
   # OpenAI GPT-4o (推荐)
   OPENAI_API_KEY=your_openai_api_key_here
   
   # DeepSeek Chat (可选)
   DEEPSEEK_API_KEY=your_deepseek_api_key_here
   ```

### 支持的AI模型

应用支持以下AI模型进行占卜解读：

#### OpenAI GPT-4o
- **模型标识**：`openai:gpt-4o`
- **API密钥**：`OPENAI_API_KEY`
- **特点**：高质量解读，响应准确

#### DeepSeek Chat
- **模型标识**：`deepseek:deepseek-chat`
- **API密钥**：`DEEPSEEK_API_KEY`
- **特点**：经济实惠，支持中文优化

**智能模型选择**：
- 应用会自动检测可用的模型
- 如果只有一个模型可用，会自动选择
- 如果有多个模型可用，会显示选择菜单
- 未设置任何API密钥时会显示配置提示

## 项目结构

```
├── src/
│   ├── cli.py              # 主CLI界面终端版
│   ├── web.py              # 现代化Web界面（NiceGUI）
│   ├── ai_agent.py         # AI代理和模型管理
│   ├── bagua.py           # 八卦相关
│   ├── celestial_stems_earthly_branches.py  # 天干地支
│   ├── five_elements.py   # 五行系统
│   ├── hand_technique.py  # 小六壬核心算法
│   ├── symbols.py         # 占卜符号
│   └── utils/
│       ├── bazi_calculator.py      # 八字计算
│       ├── calendar_converter.py   # 历法转换
│       ├── five_elements_utils.py  # 五行工具
│       └── stroke_count.py         # 笔画计算
├── data/
│   ├── bagua.json                     # 八卦数据
│   ├── celestial_stems_earthly_branches.json  # 天干地支数据
│   ├── five_elements.json             # 五行数据
│   ├── symbols.json                   # 占卜符号数据
│   └── hanzi_dictionary.txt           # 汉字字典
├── pyproject.toml          # 项目配置和依赖
└── README.md              # 项目说明
```

## 使用示例

### 小六壬占卜示例

#### CLI版本示例
```
请输入选项: 1
请输入选项: 1
输入三个数字（逗号间隔）: 1,2,3
请描述您想占卜的具体事项: 今日运势如何？

┌─────────────────────────────────────────────────────────────┐
│                        求问占卜                           │
├─────────────┬────────┬─────────────┬────────┬─────────────┤
│  初传（前期）│  关系  │  中传（中期）│  关系  │  末传（后期）│
├─────────────┼────────┼─────────────┼────────┼─────────────┤
│  【大安】   │        │   【留连】  │        │   【速喜】  │
│  （木）     │        │   （土）    │        │   （火）    │
│            │ 克→    │            │ 生→    │            │
└─────────────┴────────┴─────────────┴────────┴─────────────┘
```

#### Web版本特色
🌐 **现代化界面设计**：
- 🔮 在浏览器中直接访问，无需安装额外软件
- 🎨 深色主题 + 渐变色彩，视觉体验现代化
- 📱 响应式设计，手机、平板、电脑均可完美使用
- ✨ 智能表单验证，实时错误提示
- 📊 三传结果卡片化展示，五行关系箭头指示
- 🤖 AI解读结构化展示：标题、段落、列表、突出显示

### 八字测算示例
```
请输入公历日期（格式：YYYY-MM-DD）: 1990-01-01
请输入时间（格式：HH:MM）: 10:30
请输入性别（M/F）: M

┌─────────────────────────────────────────────────────────────┐
│                    命主-1234的生辰八字解析报告                │
└─────────────────────────────────────────────────────────────┘

基本信息：
  性别：男
  公历生日：1990-01-01 10:30
  农历生日：1989年冬月15日

八字信息：
  生辰八字：己巳年 丙子月 甲午日 己巳时
  命主五行：甲木命
  ...
```

## 注意事项

- 确保`data/`目录下的JSON数据文件完整
- 中文字符处理基于Unicode范围验证
- 历法计算使用传统农历算法
- AI功能需要网络连接和有效的OpenAI API密钥

## 开发者说明

本项目遵循中国传统文化的算法和规则，数据来源于传统典籍。如需了解更多开发细节，请查看`CLAUDE.md`文件。

## 许可证

本项目仅供学习和研究使用，请勿用于商业用途。

---

*传承中华文化，弘扬传统智慧* 🏮